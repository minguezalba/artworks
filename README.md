# Artworks

This projects consists of a manager which reads artworks from CSV files, inserts this data into a dataset, and retrieves this information in different ways.

To manage the information, we will use a MongoDB database called `artworks_db`, inside a Free Tier MongoDB cluster created with a personal Atlas Account.
The data, or artwork documents, will be saved in a specific collection called `artworks`, in `artworks_db` database.
You can find several integration tests in the repository, which create and delete a new `artworks_test` collection in each test execution.


# Requirements
To install the environment we will use [pipenv](https://pipenv-es.readthedocs.io/es/latest/) environment manager. Make sure you have it installed.
```
pip install --upgrade pip
pip install pipenv
```

# Environment installation
Install the virtual environment with pipenv.
```
pipenv install  # Production packages
pipenv install --dev  # Development/testing packages
pipenv shell  # Activate the environment
```

# Run linters, tests and documentation
[nox](https://nox.thea.codes/en/stable/) is a command-line tool that let us automate testing, linting and other task in a simple step.
Run this command to run: flake8, mypy, pytest and documentation building with sphinx.
```
pipenv run nox
```

# Run application
You can start the application by running:
```
pipenv run python app.py
```

# Usage

## Read from CSV file and insert in MongoDB collection.
The CSV file defined in -f flag will be loaded, parsed and formatted to the requested MongoDB artwork documents. Then, they will be inserted in the collection.
```
pipenv run python read_from_csv.py -f files/db_works_test.csv
```

In order to check data has been correctly inserted in the collection, run:
```
pipenv run python app.py
curl http://127.0.0.1:5000/artworks
```
This request will return all the existing artwork documents in the collection.

**Important:** notice you can only insert documents with the same _id (same id society) once! Otherwise an error will raise.

# Get right owners' metadata filtering by iswc
You can query the artworks collection by ISWC and return the right owners metadata. To do this, just run the following request:
```
pipenv run python app.py
curl http://127.0.0.1:5000/artworks/{test_iswc}/right-owners
```
Example
```
pipenv run python app.py
curl http://127.0.0.1:5000/artworks/T0420889173/right-owners
```

# API documentation in Swagger
You can check and execute the requests mentioned above through the autogenerated API documentation in Swagger via http://127.0.0.1:5000/apidocs.


# Sphinx documentation
You can check sphinx documentation via http://127.0.0.1:5000/docs.

---
Alba Mínguez Sánchez

March 2021